{"data":{"markdownRemark":null,"npmPackage":{"name":"gatsby-plugin-node-fields","description":"A Gatsby Plugin and helper function for consitent creation of node fields with support for default values, validations and transformations","keywords":["gatsby","gatsby-plugin","defaults","validation","fields","front matter","node","config"],"lastPublisher":{"name":"undistraction","avatar":"https://gravatar.com/avatar/215adbf27b92e2264832d67225e7a3ce"},"repository":{"url":"https://github.com/Undistraction/gatsby-plugin-node-fields"},"readme":{"childMarkdownRemark":{"html":"<h1 id=\"gatsby-plugin-node-fields\"><a href=\"#gatsby-plugin-node-fields\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gatsby-plugin-node-fields</h1>\n<p><code class=\"language-text\">gatsby-plugin-node-fields</code> offers you a simple, consistent way to manage the creation of fields on your nodes, with support for default values, transformations and validation of values. It is well tested and uses helpful error messages to guide you away from the rocks.</p>\n<h2 id=\"quickstart\"><a href=\"#quickstart\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Quickstart</h2>\n<h3 id=\"install\"><a href=\"#install\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\">\n      <pre class=\"language-bash\"><code class=\"language-bash\">yarn add gatsby-plugin-node-fields</code></pre>\n      </div>\n<h3 id=\"plugin-vs-function\"><a href=\"#plugin-vs-function\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Plugin vs Function</h3>\n<p>You can use <code class=\"language-text\">gatsby-plugin-node-fields</code> either as a standard Gatsby plugin, or you can use it as standalone function. Both will perform the same task, but you might prefer to keep node manipulation in your <code class=\"language-text\">gatsby-config.js</code> file instead of via a plugin defined in your <code class=\"language-text\">gatsby-config.js</code>.</p>\n<h4 id=\"plugin\"><a href=\"#plugin\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Plugin</h4>\n<p>If you want to use it as a plugin, add it as the last plugin. You can place it anywhere, but bear in mind that it will only see changes made by plugins that come before it. Unless you have a good reason not to, place it last.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">// gatsby-config.js\n\nconst plugins = [\n …\n {\n  resolve: `gatsby-plugin-node-fields`,\n  options: {\n    // Your list of descriptors\n    descriptors: [\n      …\n    ],\n  },\n }\n]\n\nmodule.exports = {\n  plugins,\n}</code></pre>\n      </div>\n<h4 id=\"function\"><a href=\"#function\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Function</h4>\n<p>If you’d prefer to use it as a function in your <code class=\"language-text\">gatsby-node.js</code> file, you need to hook into Gatsby’s <code class=\"language-text\">onCreateNode</code> yourself, passing in the three arguments it expects:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">// gatsby-node.js\n\nconst { attachFields } = require(`gatsby-plugin-node-fields`)\n\n// Your list of descriptors\nconst descriptors = [\n  …\n]\n\nexports.onCreateNode = ({ node, boundActionCreators }) =&gt; {\n  const { createNodeField } = boundActionCreators\n  attachFields(node, createNodeField, descriptors)\n}</code></pre>\n      </div>\n<h2 id=\"some-examples\"><a href=\"#some-examples\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Some Examples</h2>\n<h3 id=\"default-value-for-a-field\"><a href=\"#default-value-for-a-field\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Default value for a field</h3>\n<p>Imagine you have a series of Markdown Articles. They are mainly written by the same person with an occasional guest author. You support an <code class=\"language-text\">author</code> field in your article pages’ front matter, but you don’t want your regular author to have to add their own name to every article. Effectively you need a default value for <code class=\"language-text\">author</code>. To implement this you would create the following descriptor:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">[\n  {\n    predicate: isArticleNode,\n    fields: [\n      {\n        name: &#39;author&#39;,\n        getter: node =&gt; node.frontmatter.author,\n        defaultValue: &#39;John Doe&#39;,\n      },\n    ]\n  }\n]</code></pre>\n      </div>\n<p>This would result in <code class=\"language-text\">node.fields.author</code> being populated with either the author field of the node’s front matter, or with a default value of ‘John Doe’. In reality you’d probably want to pull the default value from a config object or similar.</p>\n<h3 id=\"transforming-a-value\"><a href=\"#transforming-a-value\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Transforming a value</h3>\n<p>Imagine you allow an author to add a <code class=\"language-text\">keywords</code> field to an article’s front matter which you use for the <code class=\"language-text\">keywords</code> metadata of the page (which will be a comma-separated list), and also extract for use as tags. To make these tags easier to work with you want to convert then to an array of strings.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">[\n  {\n    predicate: isArticleNode,\n    fields: [\n      {\n        name: &#39;tags&#39;,\n        getter: node =&gt; node.frontmatter.keywords,\n        defaultValue: &#39;&#39;,\n        transformer: value =&gt; isEmptyString(value) ? [] : cslToArray(value),\n      },\n    ]\n  }\n]</code></pre>\n      </div>\n<p>Here we again use <code class=\"language-text\">getter</code> to pull the value we want from the node’s <code class=\"language-text\">frontmatter</code>. We set it’s <code class=\"language-text\">defaultValue</code> to <code class=\"language-text\">&#39;&#39;</code>, then we use the <code class=\"language-text\">transformer</code> to either transform the value to an empty array, or to an array of strings using a helper function <code class=\"language-text\">cslToArray</code>. Note that it might seem strange to set a default value, then immediately check it and convert it to an array, but I’ve found that treating each stage discretely makes for much cleaner code. This way the transformer knows it will receive a string, making it more focused.</p>\n<h3 id=\"validating-a-value\"><a href=\"#validating-a-value\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Validating a value</h3>\n<p>It’s often better to handle invalid values at compile time rather than trying to handle these values in the UI. Imagine you allow an author to add a <code class=\"language-text\">title</code> keyword to an article’s frontmatter. Obviously without a title, an Article shouldn’t be valid and it doesn’t make sense to set a default title, so you add a validator to ensure the article’s title is a non-empty string.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">[\n  {\n    predicate: isArticleNode,\n    fields: [\n      {\n        name: &#39;title&#39;,\n        getter: node =&gt; node.frontmatter.title,\n        validator: isNonEmptyString\n      },\n    ]\n  }\n]</code></pre>\n      </div>\n<p>This will result in an error with a useful message if an article is encountered that doesn’t have a title set. For obvious reasons it’s better to set a sensible default in most cases, but in instances like this, a useful compile-time error is better than a potentially obscure runtime error, or invalid data being displayed.</p>\n<h2 id=\"overview\"><a href=\"#overview\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h2>\n<p>I have found that mixing queries for values stored in a node’s <code class=\"language-text\">frontmatter</code> with queries for values stored in generated fields is uneven and confusing, so I now transfer all values that I will use in the UI over to fields. This transfer gives us the opportunity to do a number of important things:</p>\n<ul>\n<li>set a default value</li>\n<li>validate a value</li>\n<li>transform a value</li>\n</ul>\n<h3 id=\"validation\"><a href=\"#validation\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Validation</h3>\n<p>Your descriptors will be validated against a schema when first used with useful error messages if you have added an invalid field or the value of required field is invalid or missing.</p>\n<h3 id=\"descriptors\"><a href=\"#descriptors\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Descriptors</h3>\n<p>The plugin automatically hooks into Gatsby’s <code class=\"language-text\">onCreateNode</code> life cycle hook and will check the node it receives against an array of descriptors you provide. Each descriptor must provide a <code class=\"language-text\">predicate</code> - a function that will be passed the node and decides whether the descriptor should be used to transform it. For example we might want to check if the node is Markdown node, or if it represents a file from a particular directory.</p>\n<p>If a descriptor’s <code class=\"language-text\">predicate</code> returns true, the descriptor will be used to create new fields on that node using the contents of the descriptor’s <code class=\"language-text\">fields</code> array. Each item in the <code class=\"language-text\">fields</code> array represents the creation of one or more fields and describes a series of steps</p>\n<p>Here is an example of a descriptor that will be run for all markdown nodes, validating that a title exists, then running is through a function called <code class=\"language-text\">preventOrphans</code> before saving it as a <code class=\"language-text\">title</code> field:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">[\n  // Descriptor\n  {\n    predicate: isMarkdownNode,\n    fields: [\n      {\n        name: &#39;title&#39;,\n        getter: node =&gt; node.frontmatter.title,\n        validator: isString,\n        transformer: preventOrphans,\n      },\n    ]\n  },\n]</code></pre>\n      </div>\n<h4 id=\"predicate-function\"><a href=\"#predicate-function\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><em>predicate</em> [function]</h4>\n<p>A function that receives the newly created node as its single argument and returns <code class=\"language-text\">true</code> if the descriptor should apply to that node and <code class=\"language-text\">false</code> if it doesn’t. Multiple descriptors can be applied to the same node if their predicates return true.</p>\n<h4 id=\"fields-array\"><a href=\"#fields-array\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><em>fields</em> [array]</h4>\n<p>An array of objects representing fields that will be created on the node. Each object comprises of a set of keys and values that describe the creation process of a new field. You can use as few or as many keys as needed. For example if all you want to do is set a default value you could use only the <code class=\"language-text\">name</code> and <code class=\"language-text\">defaultValue</code> keys:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">{\n  name: &#39;example&#39;,\n  defaultValue: &#39;Unknown&#39;,\n}</code></pre>\n      </div>\n<h3 id=\"fields\"><a href=\"#fields\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fields</h3>\n<p>A field can contain one or more of the following keys that describe which fields it should add, and how it should obtain and transform the data that will populate them. You can perform a one-to-one, many-to-one, or one-to-many mapping between values and fields. The order in which these fields are used is</p>\n<ul>\n<li><code class=\"language-text\">getter</code> or <code class=\"language-text\">name</code></li>\n<li><code class=\"language-text\">defaultValue</code></li>\n<li><code class=\"language-text\">validator</code></li>\n<li><code class=\"language-text\">transformer</code></li>\n<li><code class=\"language-text\">setter</code> or <code class=\"language-text\">name</code></li>\n</ul>\n<h4 id=\"name-string\"><a href=\"#name-string\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><em>name</em> [string]</h4>\n<p>A <code class=\"language-text\">name</code> field represents the name of the field that will be created. If no <code class=\"language-text\">getter</code> field is present on the descriptor, it will also be used to access a value on the node. For example if the <code class=\"language-text\">name</code> is ‘alpha’, it will create a field on the node called ‘alpha’. If no <code class=\"language-text\">getter</code> field is present on the descriptor is will try and get the value for this field from <code class=\"language-text\">node.alpha</code>.</p>\n<h4 id=\"getter-functionnode-context\"><a href=\"#getter-functionnode-context\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><em>getter</em> [function(node, context)]</h4>\n<p>A <code class=\"language-text\">getter</code> is a function that gets the value or values from the node. If a <code class=\"language-text\">getter</code> is not defined and a <code class=\"language-text\">name</code> is defined, <code class=\"language-text\">node[name]</code> will be used in its place.</p>\n<p>A simple getter might look like:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">node =&gt; node.frontmatter.title</code></pre>\n      </div>\n<p>You could also pull the value from a config object or anywhere else you like.</p>\n<h4 id=\"defaultvalue---functionnode-context\"><a href=\"#defaultvalue---functionnode-context\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><em>defaultValue</em> [* | function(node, context)]</h4>\n<p>A <code class=\"language-text\">defaultValue</code> supplies a value in instances where no value exists on the node (the value is <code class=\"language-text\">undefined</code>), or no means of getting a value has been defined on the descriptor. In the following cases <code class=\"language-text\">defaultValue</code> will be used:</p>\n<ul>\n<li>Only a <code class=\"language-text\">name</code> was defined and there is no prop on the node with that name.</li>\n<li>A prop of <code class=\"language-text\">name</code> exists with but has a value of <code class=\"language-text\">undefined</code></li>\n<li>A <code class=\"language-text\">getter</code> was defined but returned <code class=\"language-text\">undefined</code>,</li>\n<li>Neither a <code class=\"language-text\">name</code> nor a <code class=\"language-text\">getter</code> were defined.</li>\n</ul>\n<p>If <code class=\"language-text\">defaultValue</code> is a function it should return a default value. If the value of <code class=\"language-text\">defaultValue</code> is not a function, that value will be used as the default value.</p>\n<p>For example by using a function, you could use supply a default value using another property of the node:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">node =&gt; node.someOtherValue</code></pre>\n      </div>\n<h4 id=\"validator-functionvalue-node-context\"><a href=\"#validator-functionvalue-node-context\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><em>validator</em> [function(value, node, context)]</h4>\n<p>A <code class=\"language-text\">validator</code> is just a predicate that receives the value and returns true or false, depending if it deems it to be valid or not. For example we might have a descriptor that has looked up <code class=\"language-text\">node.Front Matter.slug</code>, but there is no slug defined, we use a sanitised version of the title instead:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">value =&gt; isValidDate(value)</code></pre>\n      </div>\n<h4 id=\"transformer-functionvalue-node-context\"><a href=\"#transformer-functionvalue-node-context\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><em>transformer</em> [function(value, node, context)]</h4>\n<p>A <code class=\"language-text\">transformer</code> transforms the value in some way. For example it might run the value through a function that cleans it up or formats it. A transformer function will be called with three arguments: the value, the node and the context, if defined.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">value =&gt; preventOrphans(value)</code></pre>\n      </div>\n<h4 id=\"setter-functionvalue-node-context-createnodefield\"><a href=\"#setter-functionvalue-node-context-createnodefield\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><em>setter</em> [function(value, node, context, createNodeField)]</h4>\n<p>A <em>setter</em> defines how the value(s) are translated to fields. If no <code class=\"language-text\">setter</code> is defined, the <em>name</em> field will be used to create a field of that name using Gatsby’s <code class=\"language-text\">createNodeField</code> , however using a <code class=\"language-text\">setter</code> function allows more flexibility. For example a value might be an object and we might want to transfer its values to multiple fields. A <code class=\"language-text\">setter</code> will receive three arguments: the value, <code class=\"language-text\">createNodeField</code> and any context. If you define a setter, that setter is responsible for using <code class=\"language-text\">createNodeField</code> to create fields.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">(value, node) =&gt; {\n  createNodeField({\n    node,\n    name: &#39;alpha&#39;,\n    value: value.beta\n  })\n}</code></pre>\n      </div>\n<h3 id=\"context\"><a href=\"#context\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Context</h3>\n<p>To keep things as functional as possible and prevent the need for you to reach out to external data sources from within your functions, you can pass in a <code class=\"language-text\">context</code>. Context can be anything you like, but will probably be an object. <code class=\"language-text\">getter</code>, <code class=\"language-text\">defaultValue</code>, <code class=\"language-text\">validator</code>, <code class=\"language-text\">transformer</code>, and <code class=\"language-text\">setter</code> functions all receive the context as their second argument.</p>\n<p>If you are using the plugin, pass the context as an option:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">{\n  resolve: `gatsby-plugin-node-fields`,\n  options: {\n    descriptors: [\n      …\n    ],\n    context: {\n      …\n    }\n  },\n}</code></pre>\n      </div>\n<p>If you are using the function, pass it in as the fourth argument:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">attachFields(node, createNodeField, descriptors, context)</code></pre>\n      </div>\n<h2 id=\"maintenance\"><a href=\"#maintenance\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Maintenance</h2>\n<p>Gatsby doesn’t support ES6 imports, so we need to compile our <code class=\"language-text\">./src</code> to <code class=\"language-text\">./lib</code>, then reference the compiled file from <code class=\"language-text\">gatsby-node.js</code>.</p>\n<h3 id=\"tests\"><a href=\"#tests\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tests</h3>\n<p>Tests are written with Jest:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\">\n      <pre class=\"language-bash\"><code class=\"language-bash\">yarn <span class=\"token function\">test</span></code></pre>\n      </div>","timeToRead":9}}}},"pageContext":{"slug":"/packages/gatsby-plugin-node-fields/","id":"21a91b16-63e8-5ac9-a9be-8edd0a47ce41"}}