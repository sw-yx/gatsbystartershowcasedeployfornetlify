{"data":{"markdownRemark":null,"npmPackage":{"name":"gatsby-source-craftcms","description":"Gatsby source plugin for building websites using the CraftCMS as a data source","keywords":["data","gatsby","gatsby-plugin","craftcms","graphql","craftql","source"],"lastPublisher":{"name":"gusnips","avatar":"https://gravatar.com/avatar/0e648a06516a6f6d4617b452c25ead30"},"repository":{"url":"https://github.com/gusnips/gatsby-source-craftcms"},"readme":{"childMarkdownRemark":{"html":"<h1 id=\"gatsby-source-craftcms\"><a href=\"#gatsby-source-craftcms\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gatsby-source-craftcms</h1>\n<p>Source plugin for pulling data into <a href=\"https://github.com/gatsbyjs\">Gatsby</a> from a <a href=\"https://craftcms.com\">CraftCMS</a> endpoint<br>\nBased on <a href=\"https://github.com/GraphCMS/gatsby-source-graphcms\">gatsby-source-graphcms</a><br>\nTested in Gatsby v1 and v2</p>\n<h2 id=\"install\"><a href=\"#install\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install</h2>\n<ol>\n<li><code class=\"language-text\">yarn add gatsby-source-craftcms</code> or <code class=\"language-text\">npm i gatsby-source-craftcms</code></li>\n<li>Make sure plugin is referenced in your Gatsby config, as in the\n<a href=\"#usage\">example below</a></li>\n<li><code class=\"language-text\">gatsby develop</code></li>\n</ol>\n<h2 id=\"usage\"><a href=\"#usage\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Usage</h2>\n<p><em>In your gatsby config…</em></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    resolve<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`gatsby-source-craftcms`</span></span><span class=\"token punctuation\">,</span>\n    options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      endpoint<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`craftcms.mydomain.com/api`</span></span><span class=\"token punctuation\">,</span>\n      token<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`graphql_token`</span></span><span class=\"token punctuation\">,</span>\n      query<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`{\n          categories(site:\"default\",groupId:12) {\n              id\n              title\n              slug\n              uri\n          },\n          entries(section:[news],site:\"premium\") {\n            id\n            uri\n            title\n            slug\n          },\n          home: entries(section:[home],site:\"premium\") {\n            id\n            uri\n            title\n            slug\n          }\n      }`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></code></pre>\n      </div>\n<p>Gatsby’s data processing layer begins with “source” plugins, configured in <code class=\"language-text\">gatsby-config.js</code>. Here the site sources its data from the CraftCMS endpoint. Use an <code class=\"language-text\">.env</code> file or set environment variables directly to access the CraftCMS<br>\nendpoint and token. This avoids committing potentially sensitive data.  </p>\n<p><em>In your gatsby-node.js …</em>  </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createPages</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> graphql<span class=\"token punctuation\">,</span> boundActionCreators <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createPage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> boundActionCreators<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> postPage <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"src/templates/post.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>\n      <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`{\n        allEntry(sort: { fields: [postDate], order: DESC}){\n          edges {\n            news: node{\n              id\n              title\n              slug\n              postDate\n            }\n          }\n        }\n      }`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>result <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>allEntry<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>edge <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            path<span class=\"token punctuation\">:</span> edge<span class=\"token punctuation\">.</span>news<span class=\"token punctuation\">.</span>slug<span class=\"token punctuation\">,</span>\n            component<span class=\"token punctuation\">:</span> postPage<span class=\"token punctuation\">,</span>\n            context<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n              slug<span class=\"token punctuation\">:</span> edge<span class=\"token punctuation\">.</span>news<span class=\"token punctuation\">.</span>slug\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<h2 id=\"plugin-options\"><a href=\"#plugin-options\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Plugin options</h2>\n<table>\n<thead>\n<tr>\n<th align=\"right\"></th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"right\"><strong>endpoint</strong></td>\n<td align=\"left\">indicates the endpoint to use for the graphql connection</td>\n</tr>\n<tr>\n<td align=\"right\"><strong>token</strong></td>\n<td align=\"left\">The API access token. Optional if the endpoint is public</td>\n</tr>\n<tr>\n<td align=\"right\"><strong>query</strong></td>\n<td align=\"left\">The GraphQL query to execute against the endpoint</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"how-to-query--graphql\"><a href=\"#how-to-query--graphql\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to query : GraphQL</h2>\n<p>Let’s say you have a GraphQL type called <code class=\"language-text\">Categories</code>. You would query all artists\nlike so:</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\">\n      <pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token punctuation\">{</span>\n  allCategory <span class=\"token punctuation\">{</span>\n    id\n    title\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>entries example, to use in your template:  </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageQuery <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token string\">`\nquery GetPost($slug: String!) {\n  entry(slug: { eq: $slug }) {\n    id\n    slug\n    title\n    summary\n    uri\n    enableComments\n    contentPost {\n      block{\n        content\n        totalPages\n      }\n      quoteText\n      imagem{\n        url\n      }\n      titleH1\n      subtitleH2\n    }\n    category {\n      title\n      slug\n    }\n    tags{\n      title\n      slug\n    }\n  }\n}\n`</span></span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<h2 id=\"testing-plugin-contributions\"><a href=\"#testing-plugin-contributions\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Testing plugin contributions</h2>\n<ol>\n<li><code class=\"language-text\">cd</code> to the Gatsby install you want to test your changes to the plugin code\nwith, or clone <a href=\"https://github.com/gusnips/gatsby-craftcms-example\">@CraftCMS/gatsby-craftcms-example</a></li>\n<li>If you cloned the example or previously installed the plugin through <code class=\"language-text\">yarn</code>\nor <code class=\"language-text\">npm</code>, <code class=\"language-text\">yarn remove gatsby-source-craftcms</code> or <code class=\"language-text\">npm r\ngatsby-source-craftcms</code></li>\n<li><code class=\"language-text\">mkdir plugins</code> if it does not exist yet and <code class=\"language-text\">cd</code> into it</li>\n<li>Your path should now be something like\n<code class=\"language-text\">~/code/gusnips/myKillerGatsbySite/plugins/</code></li>\n<li><code class=\"language-text\">git clone https://github.com/gusnips/gatsby-source-craftcms.git</code></li>\n<li><code class=\"language-text\">cd gatsby-source-craftcms</code></li>\n<li><code class=\"language-text\">yarn</code> or <code class=\"language-text\">yarn &amp;&amp; yarn watch</code> in plugin’s directory for auto-rebuilding the\nplugin after you make changes to it—only during development</li>\n<li>Make sure plugin is referenced in your Gatsby config, as in the\n<a href=\"#usage\">example below</a></li>\n<li>From there you can <code class=\"language-text\">cd ../.. &amp;&amp; yarn &amp;&amp; yarn develop</code> to test</li>\n</ol>\n<h3 id=\"every-time-you-rebuild-the-plugin-you-must-restart-gatsbys-development-server-to-reflect-the-changes-in-your-test-environment\"><a href=\"#every-time-you-rebuild-the-plugin-you-must-restart-gatsbys-development-server-to-reflect-the-changes-in-your-test-environment\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Every time you rebuild the plugin, you must restart Gatsby’s development server to reflect the changes in your test environment.</h3>","timeToRead":3}}}},"pageContext":{"slug":"/packages/gatsby-source-craftcms/","id":"ec5b231e-da7a-5bf2-bfbd-eab1eb5e4a98"}}