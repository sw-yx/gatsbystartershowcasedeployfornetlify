{"data":{"markdownRemark":null,"npmPackage":{"name":"gatsby-source-s3-image","description":"GatsbyJS plugin to source images from S3-compliant APIs, with EXIF-extracting superpowers.","keywords":["gatsbyjs","gatsby","gatsby-plugin","photography","s3","exif"],"lastPublisher":{"name":"jesses","avatar":"https://gravatar.com/avatar/be22eff98f017d4cac53d3a55e4207f8"},"repository":{"url":"https://github.com/jessestuart/gatsby-source-s3-image"},"readme":{"childMarkdownRemark":{"html":"<h2 id=\"gatsby-source-s3-image\"><a href=\"#gatsby-source-s3-image\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gatsby-source-s3-image</h2>\n<p><a href=\"https://circleci.com/gh/jessestuart/gatsby-source-s3-image\"><img src=\"https://circleci.com/gh/jessestuart/gatsby-source-s3-image.svg?style=shield\" alt=\"CircleCI\"></a>\n<a href=\"https://www.npmjs.com/package/gatsby-source-s3-image\"><img src=\"https://img.shields.io/npm/v/gatsby-source-s3-image.svg\" alt=\"npm\"></a></p>\n<p>GatsbyJS Source plugin for <strong>converting images from an S3-compliant API[1] into\nGatsbyJS nodes</strong> (with full support for hooking into all of the powerful features\nthe <code class=\"language-text\">GatsbyImage</code> API has to offer).</p>\n<p>Additionally, <code class=\"language-text\">gatsby-source-s3-image</code> will <strong>automatically detect and extract image\nEXIF metadata from your photos</strong>, and expose this data at the GraphQL layer as\nnode fields. Currently supported EXIF fields include:</p>\n<ul>\n<li><code class=\"language-text\">DateCreatedISO</code> (String)</li>\n<li><code class=\"language-text\">DateTimeOriginal</code> (Number)</li>\n<li><code class=\"language-text\">ExposureTime</code> (Number)</li>\n<li><code class=\"language-text\">FNumber</code> (Number)</li>\n<li><code class=\"language-text\">FocalLength</code> (Number)</li>\n<li><code class=\"language-text\">ISO</code> (Number)</li>\n<li><code class=\"language-text\">LensModel</code> (String)</li>\n<li><code class=\"language-text\">Model</code> (String)</li>\n<li><code class=\"language-text\">ShutterSpeedValue</code> (Number)</li>\n</ul>\n<p>These fields are properties of the “wrapper” node, <code class=\"language-text\">S3ImageAsset</code>. This type\ncomposes the <code class=\"language-text\">ImageSharp</code> node, the <code class=\"language-text\">File</code> node representing the cached image on\ndisk (fetched via the <code class=\"language-text\">RemoteFileNode</code> API), and lastly the extracted EXIF data.\nAs a result, you can easily retrieve both a set of images as well as any subset\nof their associated metadata in a single request. For example:</p>\n<div class=\"gatsby-highlight\" data-language=\"es6\">\n      <pre class=\"language-es6\"><code class=\"language-es6\">export const pageQuery = graphql`\n  query PhotographyPostsQuery {\n    allS3ImageAsset {\n      edges {\n        node {\n          id\n          EXIF {\n            DateCreatedISO\n            ExposureTime\n            FNumber\n            ShutterSpeedValue\n          }\n          childImageSharp {\n            original {\n              height\n              width\n            }\n            thumbnailSizes: sizes(maxWidth: 512) {\n              aspectRatio\n              src\n              srcSet\n              sizes\n            }\n            largeSizes: sizes(maxWidth: 1536) {\n              aspectRatio\n              src\n              srcSet\n              sizes\n            }\n          }\n        }\n      }\n    }\n  }\n`</code></pre>\n      </div>\n<p>[1]: This includes AWS S3, of course, as well as third-party solutions like\nDigital Ocean Spaces, or open source / self-hosted products like Minio.</p>\n<h3 id=\"setup\"><a href=\"#setup\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h3>\n<ol>\n<li>Add the dependency to your <code class=\"language-text\">package.json</code>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"console\">\n      <pre class=\"language-console\"><code class=\"language-console\">$ yarn add gatsby-source-s3-image\n$ # Or:\n$ npm install --save gatsby-source-s3-image</code></pre>\n      </div>\n<ol>\n<li>Next, register the plugin with the GatsbyJS runtime in the <code class=\"language-text\">plugins</code> exported\nfrom your <code class=\"language-text\">gatsby-config.js</code> file, filling in the values to point to wherever\nyour bucket is hosted:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"es6\">\n      <pre class=\"language-es6\"><code class=\"language-es6\">const sourceS3 = {\n  resolve: &#39;gatsby-source-s3-image&#39;,\n  options: {\n    bucketName: &#39;jesse.pics&#39;,\n    domain: null, // Not necessary to define here for AWS S3; defaults to `s3.amazonaws.com`\n    protocol: &#39;https&#39;,\n  },\n}\n\nconst plugins = [\n  sourceS3,\n  // ...\n]\n\nmodule.exports = { plugins }</code></pre>\n      </div>\n<h3 id=\"querying\"><a href=\"#querying\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Querying</h3>\n<ol>\n<li>As mentioned above, <code class=\"language-text\">gatsby-source-s3-image</code> exposes nodes of type\n<code class=\"language-text\">S3ImageAsset</code>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"flow\">\n      <pre class=\"language-flow\"><code class=\"language-flow\"><span class=\"token keyword\">type</span> S3ImageAssetNode <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  id<span class=\"token punctuation\">:</span> <span class=\"token type tag\">String</span><span class=\"token punctuation\">,</span>\n  absolutePath<span class=\"token punctuation\">:</span> <span class=\"token type tag\">String</span><span class=\"token punctuation\">,</span>\n  ETag<span class=\"token punctuation\">:</span> <span class=\"token type tag\">String</span><span class=\"token punctuation\">,</span>\n  Key<span class=\"token punctuation\">:</span> <span class=\"token type tag\">String</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">EXIF</span><span class=\"token punctuation\">:</span> <span class=\"token operator\">?</span>ExifData<span class=\"token punctuation\">,</span> <span class=\"token comment\">// ExifData is defined below --></span>\n  internal<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    content<span class=\"token punctuation\">:</span> <span class=\"token type tag\">String</span><span class=\"token punctuation\">,</span>\n    contentDigest<span class=\"token punctuation\">:</span> <span class=\"token type tag\">String</span><span class=\"token punctuation\">,</span>\n    mediaType<span class=\"token punctuation\">:</span> <span class=\"token type tag\">String</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">type</span><span class=\"token punctuation\">:</span> <span class=\"token type tag\">String</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> ExifData <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  DateCreatedISO<span class=\"token punctuation\">:</span> <span class=\"token type tag\">String</span><span class=\"token punctuation\">,</span>\n  DateTimeOriginal<span class=\"token punctuation\">:</span> <span class=\"token type tag\">Number</span><span class=\"token punctuation\">,</span>\n  ExposureTime<span class=\"token punctuation\">:</span> <span class=\"token type tag\">Number</span><span class=\"token punctuation\">,</span>\n  FNumber<span class=\"token punctuation\">:</span> <span class=\"token type tag\">Number</span><span class=\"token punctuation\">,</span>\n  FocalLength<span class=\"token punctuation\">:</span> <span class=\"token type tag\">Number</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">ISO</span><span class=\"token punctuation\">:</span> <span class=\"token type tag\">Number</span><span class=\"token punctuation\">,</span>\n  LensModel<span class=\"token punctuation\">:</span> <span class=\"token type tag\">String</span><span class=\"token punctuation\">,</span>\n  Model<span class=\"token punctuation\">:</span> <span class=\"token type tag\">String</span><span class=\"token punctuation\">,</span>\n  ShutterSpeedValue<span class=\"token punctuation\">:</span> <span class=\"token type tag\">Number</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>Not only can this be used to populate page data, I’ve found it useful in\nbootstrapping the pages themselves, e.g., to dynamically create dynamic photo\ngallery pages at build time depending on the contents of a bucket,\nsomething like:</p>\n<div class=\"gatsby-highlight\" data-language=\"es6\">\n      <pre class=\"language-es6\"><code class=\"language-es6\">// In `gatsby-node.js` -- using a query like this:\nconst photographyQuery = `{\n  allS3ImageAsset {\n    edges {\n      node {\n        ETag\n        EXIF {\n          DateCreatedISO\n        }\n      }\n    }\n  }\n}`\n\n// We can then dynamically generate pages based on EXIF data, like this:\nconst createPages = ({ graphql, boundActionCreators }) =&gt; {\n  const { createPage } = boundActionCreators\n  const photographyTemplate = path.resolve(&#39;./src/templates/photography-post.js&#39;)\n\n  const createPhotographyPosts = edges =&gt; {\n    // Create the photography &quot;album&quot; pages -- these are a collection of photos\n    // grouped by ISO date.\n    const imagesGroupedByDate = _.groupBy(edges, &#39;node.EXIF.DateCreatedISO&#39;)\n    _.each(imagesGroupedByDate, (images, date) =&gt; {\n      createPage({\n        path: `/photography/${date}`,\n        component: photographyTemplate,\n        context: {\n          name: date,\n          datetime: DateTime.fromISO(date),\n          type: PageType.Photography,\n        },\n      })\n    })\n  }\n}</code></pre>\n      </div>","timeToRead":3}}}},"pageContext":{"slug":"/packages/gatsby-source-s3-image/","id":"52de6eed-afae-59dd-a558-34eafd63686b"}}